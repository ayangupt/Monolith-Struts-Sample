# **Containerization Plan**

## **Goal**
Setup Dockerfiles for the project to run inside of containers. Do not set up docker-compose for running locally as it is not required.

## **List of services to be containerized**

### Service 1: SkiShop Monolith Web Application
- **Path:** /home/ayangupta/App-Modernization-Demo/1-struts-original
- **Language:** Java 1.5
- **Framework:** Apache Struts 1.3.10
- **Build System:** Maven 2.x compatible
- **Package Type:** WAR (skishop-monolith.war)
- **Runtime:** Tomcat 6.0.53
- **Database:** PostgreSQL 9.2+ (external dependency)
- **Port:** 8080
- **Dependencies:**
  - Apache Struts 1.3.10 (core, taglib, tiles, extras)
  - Commons libraries (dbcp, pool, dbutils, fileupload)
  - PostgreSQL JDBC driver (9.2-1004-jdbc3)
  - Log4j 1.2.17
  - JavaMail 1.4.7
- **Configuration:**
  - app.properties with environment variable support (${TOKEN} placeholders)
  - JNDI datasource configuration in META-INF/context.xml
  - Log4j properties

## **Execution Steps**
> **Below are the steps for Copilot to follow; ask Copilot to update or execute this plan.**

### Step 1: Check containerization pre-requisites
1. Ensure Docker is installed and running
2. Verify build context contains necessary binaries (JDK installer)

### Step 2: Scan the repository
1. Use tool 'appmod-analyze-repository' to detect technologies and dependencies
2. Identify build system, frameworks, and configuration files

### Step 3: Check code is ready to run in a local container
1. **‚úÖ Configuration Review:**
   - Application uses app.properties with ${TOKEN} placeholders for environment variables
   - Supports environment variable injection (e.g., DB_PASSWORD)
   - JNDI configuration in META-INF/context.xml
   
2. **üìã External Dependencies to host in cloud:**
   - PostgreSQL 9.2+ database
   - SMTP server for mail functionality (javax.mail)
   - Consider: Database schema initialization (src/main/resources/db/schema.sql)

3. **‚ö†Ô∏è Configuration hardcoding check:**
   - Review app.properties for hardcoded values
   - Ensure database connection uses environment variables
   - Verify mail server configuration is externalized

### Step 4: Create Dockerfile for the project
1. Use tool 'appmod-plan-generate-dockerfile' with:
   - repositoryPath: /home/ayangupta/App-Modernization-Demo/1-struts-original
   - language: java
   - languageVersion: 1.5 (from pom.xml maven.compiler.target)
   - framework: struts
   - environment: production
   - targetPlatform: linux/amd64 (JDK 5 requires amd64)
   - criticalityTier: tier-2
   - trafficLevel: medium
   - detectedDependencies: ["struts", "postgresql", "log4j", "mail"]

2. Implement Dockerfile with:
   - Multi-stage build (build stage + runtime stage)
   - Build stage: Install JDK 5, Maven 2.2.1, compile WAR
   - Runtime stage: Install JDK 5, Tomcat 6.0.53, deploy WAR
   - Copy PostgreSQL JDBC driver to Tomcat lib
   - Expose port 8080
   - Use entrypoint script for configuration

### Step 5: Build the Docker images
1. Build the Docker image:
   ```bash
   docker build --build-arg JDK_LICENSE=accept -t skishop-monolith:1.0.0 .
   ```
2. Tag with latest:
   ```bash
   docker tag skishop-monolith:1.0.0 skishop-monolith:latest
   ```
3. Verify image was created:
   ```bash
   docker images | grep skishop-monolith
   ```

### Step 6: Summarize the successful containerization
1. **Created Dockerfiles:**
   - `/home/ayangupta/App-Modernization-Demo/1-struts-original/Dockerfile`
   
2. **Code edits required:**
   - ‚úÖ Externalize database connection strings (use environment variables)
   - ‚úÖ Externalize mail server configuration
   - ‚úÖ Review app.properties for hardcoded values
   - ‚úÖ Ensure logging outputs to console (not just files)
   - ‚úÖ Database schema must be initialized separately (cloud database)
   
3. **Runtime requirements:**
   - PostgreSQL database instance (cloud-hosted)
   - Environment variables: DB_HOST, DB_PORT, DB_NAME, DB_USER, DB_PASSWORD
   - Environment variables: MAIL_HOST, MAIL_PORT (if using email features)
   - Database schema initialization from src/main/resources/db/schema.sql
